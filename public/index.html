<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SongStitch</title>
    <meta name="description" content="Generate an image collage of your most played albums!">
    <meta name="keywords" content="lastfm, collage, image, music, albums">
    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="SongStitch">
    <meta property="og:description" content="Generate an image collage of your most played albums!">
    <meta property="og:image" content="/public/logo.png">
    <meta property="og:url" content="https://songstitch.art/">
    <!-- Canonical URL -->
    <link rel="canonical" href="https://songstitch.art/">
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/public/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/public/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/public/apple-touch-icon.png">
    <!-- manifest -->
    <link rel="manifest" href="/public/site.webmanifest" />
    <style>
      @font-face {
        font-family: "Secular One";
        src: url("/public/SecularOne-Regular.ttf") format('truetype');
        font-display: swap;
      }
      a:link {color: black;}      /* unvisited link */
      a:visited { color:black;}  /* visited link */
      a:hover {color: #f2f2f2; background: black;}  /* selected link */
      a:active {color: #f2f2f2; background: black;}  /* selected link */
      html {
        background-color: #ffffff;
        background-image: radial-gradient(#f2f2f2 2px, #ffffff 2px);
        background-size: 40px 40px;
      }
      body, input[type='text']  {
        display: grid;
        place-items: center;
        min-height: 100%;
        font-family: 'Secular One', avenir, Helvetica, sans-serif;
        padding: 20px;
        box-sizing: border-box;
      }
      form {
        max-width: 500px;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.1);
      }
      #username, input[type=text], select, input[type=number] {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 1em;
        background-color: white;
        background: none;
        color: black;
        font-family: "Secular One";
      }
      input[type=submit],  input[type=button] {
        width: 100%;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1em;
      }
      input[type=submit]:hover {
        background-color: #45a049;
      }
      input:focus {
        outline: none;
        box-shadow: 0 0 0 1px black;
      }
      label {
        font-weight: bold;
        font-size: 1.2em;
      }
      h2 {
        text-align: center;
        font-size: 2em;
      }
      @media (max-width: :00px) {
        body {
          padding: 10px;
        }
        form {
          padding: 10px;
        }
        #username, input[type=text], select, input[type=number], input[type=submit] {
          padding: 10px 15px;
          font-size: 0.8em;
          font-family: "Secular One";
        }
        h2 {
          font-size: 1.5em;
        }

        label {
          font-size: 1em;
        }
      }
      .header-img {
        border-radius: 0.5em;
        width: 100%;
        max-width: 40vh;
        display: block;
        height: auto;
        margin: auto;
      }

      .footer {
        text-align: center;
        text-align: -webkit-center;
      }

      .footer a {
      }

      .btn-grad {
        background-image: linear-gradient(to right, #DA22FF 0%, #9733EE  51%, #DA22FF  100%);
        margin: 10px;
        padding: 15px 45px;
        text-align: center;
        text-transform: uppercase;
        transition: 0.5s;
        background-size: 200% auto;
        color: white;
        box-shadow: 0 0 20px #eee;
        border-radius: 10px;
        display: block;
      }
      .btn-grad:hover {
        background-position: right center;
        color: #fff;
        text-decoration: none;
      }
      .asterisk {
        color: #ff0000;
        font-weight: normal;
      }
      .nonbold {
        font-weight: normal;
        color: grey;
      }

      /* checkbox */
      @supports (-webkit-appearance: none) or (-moz-appearance: none) {
        .checkbox-wrapper input[type=checkbox] {
          --active: #275EFE;
          --active-inner: #fff;
          --focus: 2px rgba(39, 94, 254, .3);
          --border: #BBC1E1;
          --border-hover: #275EFE;
          --background: #fff;
          --disabled: #F6F8FF;
          --disabled-inner: #E1E6F9;
          -webkit-appearance: none;
          -moz-appearance: none;
          height: 21px;
          outline: none;
          display: inline-block;
          vertical-align: top;
          position: relative;
          margin: 0;
          cursor: pointer;
          border: 1px solid var(--bc, var(--border));
          background: var(--b, var(--background));
          transition: background 0.3s, border-color 0.3s, box-shadow 0.2s;
        }
        .checkbox-wrapper input[type=checkbox]:after {
          content: "";
          display: block;
          left: 0;
          top: 0;
          position: absolute;
          transition: transform var(--d-t, 0.3s) var(--d-t-e, ease), opacity var(--d-o, 0.2s);
        }
        .checkbox-wrapper input[type=checkbox]:checked {
          --b: var(--active);
          --bc: var(--active);
          --d-o: .3s;
          --d-t: .6s;
          --d-t-e: cubic-bezier(.2, .85, .32, 1.2);
        }
        .checkbox-wrapper input[type=checkbox]:disabled {
          --b: var(--disabled);
          cursor: not-allowed;
          opacity: 0.9;
        }
        .checkbox-wrapper input[type=checkbox]:disabled:checked {
          --b: var(--disabled-inner);
          --bc: var(--border);
        }
        .checkbox-wrapper input[type=checkbox]:disabled + label {
          cursor: not-allowed;
        }
        .checkbox-wrapper input[type=checkbox]:hover:not(:checked):not(:disabled) {
          --bc: var(--border-hover);
        }
        .checkbox-wrapper input[type=checkbox]:focus {
          box-shadow: 0 0 0 var(--focus);
        }
        .checkbox-wrapper input[type=checkbox]:not(.switch) {
          width: 21px;
        }
        .checkbox-wrapper input[type=checkbox]:not(.switch):after {
          opacity: var(--o, 0);
        }
        .checkbox-wrapper input[type=checkbox]:not(.switch):checked {
          --o: 1;
        }
        .checkbox-wrapper input[type=checkbox] + label {
          display: inline-block;
          vertical-align: middle;
          cursor: pointer;
          margin-left: 4px;
        }

        .checkbox-wrapper input[type=checkbox]:not(.switch) {
          border-radius: 7px;
        }
        .checkbox-wrapper input[type=checkbox]:not(.switch):after {
          width: 5px;
          height: 9px;
          border: 2px solid var(--active-inner);
          border-top: 0;
          border-left: 0;
          left: 7px;
          top: 4px;
          transform: rotate(var(--r, 20deg));
        }
        .checkbox-wrapper input[type=checkbox]:not(.switch):checked {
          --r: 43deg;
        }
      }

      .checkbox-wrapper * {
        box-sizing: inherit;
      }
      .checkbox-wrapper *:before,
      .checkbox-wrapper *:after {
        box-sizing: inherit;
      }
      .checkbox-wrapper {
        padding-top: 1em;
      }
      fieldset {
        border:  1px solid #ccc;
        border-radius: 4px;
      }


      .btn-grad-embed {
        background-image: linear-gradient(to right, #DD5E89 0%, #F7BB97  51%, #DD5E89  100%);
        margin: 10px;
        padding: 15px 45px;
        text-align: center;
        text-transform: uppercase;
        transition: 0.5s;
        background-size: 200% auto;
        color: white;
        box-shadow: 0 0 20px #eee;
        border-radius: 10px;
        display: block;
      }

      .btn-grad-embed:hover {
        background-position: right center; /* change the direction of the change here */
        color: #fff;
        text-decoration: none;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
      }

      .modal-content {
        position: relative;
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        width: 50%;
        border-radius: 4px;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        position: absolute;
        top: 0;
        right: 15px;
        transition: 0.3s;
      }

      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

      pre {
        overflow-x: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .btn-copy {
        font-size: 1em;
        padding: 10px;
        color: #fff;
        background-color: #4CAF50;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .btn-copy:hover {
        background-color: #45a049;
      }
      .highlight-wrapper {
        display: block;
      }
      .highlight {
        position: relative;
        z-index: 0;
        padding: 0;
        margin: 0;
        border-radius: 4px;
      }
      .highlight > .chroma {
        color: #d0d0d0;
        background-color: #212121;
        position: static;
        z-index: 1;
        border-radius: 4px;
        padding: 2em;
      }
      .chroma {
        overflow: auto;
      }
      .chroma .lntable {
        display: table;
        width: 100%;
        padding: 0 0 5px;
        margin: 0;
        border-spacing: 0;
        border: 0;
        overflow: auto;
      }
      .chroma .lntd:first-child {
        padding: 7px 7px 7px 10px;
        margin: 0;
      }
      .chroma .lntd:last-child {
        padding: 7px 10px 7px 7px;
        margin: 0;
      }
      .copy-code-button {
        position: absolute;
        z-index: 2;
        right: 0;
        top: 0;
        font-size: 13px;
        font-weight: 700;
        line-height: 14px;
        width: 65px;
        color: #232326;
        background-color: #7f7f7f;
        border: 1.25px solid #232326;
        border-top-left-radius: 0;
        border-top-right-radius: 4px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 4px;
        white-space: nowrap;
        padding: 4px 4px 5px 4px;
        margin: 0 0 0 1px;
        cursor: pointer;
        opacity: 0.6;
      }
      .copy-code-button:hover,
      .copy-code-button:focus,
      .copy-code-button:active,
      .copy-code-button:active:hover {
        color: #222225;
        background-color: #b3b3b3;
        opacity: 0.8;
      }
      .copyable-text-area {
        position: absolute;
        height: 0;
        z-index: -1;
        opacity: 0.01;
      }
    </style>
  </head>
  <body>
    <main class="main">
      <img src="/public/logo.png" class="header-img" alt="SongStitch Logo">
      <h2>Last.fm Collage Generator</h2>
      <p>Generate an image collage of your most played albums!</p>
      <form action="/collage" method="get" id="form">
        <label for="username">Your Last.fm Username <span class="asterisk">*</span></label>
        <br>
        <input required autofocus autocomplete="on" placeholder="Last.fm username" title="Username must be between 2 to 15 characters, begin with a letter and contain only letters, numbers, '_' or '-'" pattern="^[a-zA-Z][a-zA-Z0-9_-]{1,14}$" type="text" id="username" name="username">
        <br>
        <label for="period">Period of Time</label><br>
        <select name="period" id="period">
          <option value="7day">7 Days</option>
          <option value="1month">1 Month</option>
          <option value="3month">3 Months</option>
          <option value="6month">6 Months</option>
          <option value="12month">1 Year</option>
          <option value="overall">All Time</option>
        </select><br>
        <fieldset id="fieldset">
          <legend>Collage Options</legend>
          <div class="checkbox-wrapper">
            <input checked value="true" name="artist" id="artist" type="checkbox" onclick="updateValue(this)">
            <label for="artist">Display Artist Name</label>
          </div>
          <div class="checkbox-wrapper">
            <input checked value="true" name="album" id="album" type="checkbox" onclick="updateValue(this)">
            <label for="album">Display Album Name</label>
          </div>
          <div class="checkbox-wrapper">
            <input checked value="true" name="playcount" id="playcount" type="checkbox" onclick="updateValue(this)">
            <label for="playcount">Display Play Count</label>
          </div>
          <br>
          <label for="rows">Number of Rows <span class="nonbold">(max. 10)</span></label><br>
          <input inputmode="decimal" type="number" pattern="\d*" id="rows" name="rows" min="1" max="10" value="3"><br>
          <label inputmode="decimal" for="columns">Number of Columns <span class="nonbold">(max. 10)</span></label><br>
          <input type="number" pattern="\d*" id="columns" name="columns" min="1" max="10" value="3"><br>
        </fieldset>
        <input name="submit" class="btn-grad" type="submit" value="Generate">
        <input name="embed" class="btn-grad-embed" type="button" value="embed" onclick="embedUrl()">
      </form>
      <div id="myModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <div class="highlight">
            <pre class="chroma"><code id="embedUrl" class="language-python"></code></pre>
          </div>
        </div>
      </div>
      <script>
        function embedUrl() {
          var form = document.getElementById('form');
          var action = form.action;
          var elems = form.elements;
          var url = action;
          var first = true;
          for(var i = 0; i < elems.length; i++) {
            if(elems[i].type === "submit" || elems[i].name === "embed" || elems[i].id === "fieldset") continue;
            if(first) {
              url += '?';
              first = false;
            } else {
              url += '&';
            }
            url += elems[i].name + '=' + encodeURIComponent(elems[i].value);
            var embedData = '<img class="songstitch-collage" src="' + url + '">';
          }
          document.getElementById('embedUrl').textContent = embedData;
          modal.style.display = "block";
          return false; // prevent the form from submitting
        }
        function copyToClipboard() {
          var urlText = document.getElementById('embedUrl').textContent;
          navigator.clipboard.writeText(urlText).then(function() {
            console.log('Copied to clipboard');
          }).catch(function() {
            console.error('Failed to copy text');
          });
        }
        var modal = document.getElementById("myModal");
        var span = document.getElementsByClassName("close")[0];
        span.onclick = function() {
          modal.style.display = "none";
        }
        window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        }
      </script>
      <script>
        var username = document.querySelector('#username');
        username.value = localStorage.getItem('username') || '';
        document.querySelector('#form').addEventListener('submit', function() {
          localStorage.setItem('username', username.value);
        });
      </script>
    </main>
    <div class="footer" >
      <p id="links">Made with ❤️ by
        <span><a href="https://github.com/theden" target="_blank" rel="noopener">TheDen</a></span>
        <span><a href="https://github.com/BradLewis" target="_blank" rel="noopener">BradLewis</a></span>
      </p>
      <script>
        window.onload = function() {
          document.getElementById("artist").value = "true";
          document.getElementById("album").value = "true";
          document.getElementById("playcount").value = "true";

        }
        function updateValue(checkbox) {
          checkbox.value = checkbox.checked ? "true" : "false";
        }
      </script>
      <script>
        window.onload = function() {
          var p = document.getElementById('links');
          var spans = p.getElementsByTagName('span');
          var spanArr = Array.prototype.slice.call(spans);
          spanArr.sort(function() { return 0.5 - Math.random() });
          spanArr.forEach(function(span) {
            p.appendChild(span); // This will move the <span> element (containing an <a> tag) to the end of the list.
          });
          // We need to adjust the "and" position after the first link
          var andNode = document.createTextNode(" and ");
          p.insertBefore(andNode, p.children[1]);
        }
      </script>
      <script>
        function createCopyButton(highlightDiv) {
          const button = document.createElement("button");
          button.className = "copy-code-button";
          button.type = "button";
          button.innerText = "Copy";
          button.addEventListener("click", () =>
            copyCodeToClipboard(button, highlightDiv)
          );
          addCopyButtonToDom(button, highlightDiv);
        }

        async function copyCodeToClipboard(button, highlightDiv) {
          const codeToCopy = highlightDiv.querySelector(":last-child > .chroma > code")
            .innerText;
          try {
            result = await navigator.permissions.query({ name: "clipboard-write" });
            if (result.state == "granted" || result.state == "prompt") {
              await navigator.clipboard.writeText(codeToCopy);
            } else {
              copyCodeBlockExecCommand(codeToCopy, highlightDiv);
            }
          } catch (_) {
            copyCodeBlockExecCommand(codeToCopy, highlightDiv);
          } finally {
            codeWasCopied(button);
          }
        }

        function copyCodeBlockExecCommand(codeToCopy, highlightDiv) {
          const textArea = document.createElement("textArea");
          textArea.contentEditable = "true";
          textArea.readOnly = "false";
          textArea.className = "copyable-text-area";
          textArea.value = codeToCopy;
          highlightDiv.insertBefore(textArea, highlightDiv.firstChild);
          const range = document.createRange();
          range.selectNodeContents(textArea);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
          textArea.setSelectionRange(0, 999999);
          document.execCommand("copy");
          highlightDiv.removeChild(textArea);
        }

        function codeWasCopied(button) {
          button.blur();
          button.innerText = "Copied!";
          setTimeout(function () {
            button.innerText = "Copy";
          }, 2000);
        }

        function addCopyButtonToDom(button, highlightDiv) {
          highlightDiv.insertBefore(button, highlightDiv.firstChild);
          const wrapper = document.createElement("div");
          wrapper.className = "highlight-wrapper";
          highlightDiv.parentNode.insertBefore(wrapper, highlightDiv);
          wrapper.appendChild(highlightDiv);
        }

        document
          .querySelectorAll(".highlight")
          .forEach((highlightDiv) => createCopyButton(highlightDiv));
      </script>
    </div>
  </body>
</html>
